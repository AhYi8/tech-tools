<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Base64 编码/解码工具</title>
    <!-- 引入 Tailwind CSS for styling -->
    <script src="../../vendor/js/tailwind.js"></script>
    <!-- 引入 Google Fonts -->
    <link href="../../vendor/css/google-fonts.css" rel="stylesheet" />
    <style>
      /* --- 暗色科技风格自定义样式 --- */
      body {
        font-family: "Noto Sans SC", sans-serif;
        background-color: #0d1117;
        color: #c9d1d9;
        overflow-x: hidden; /* 防止横向滚动条 */
      }

      /* --- 动态背景 --- */
      .background-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: radial-gradient(
          ellipse at bottom,
          #1b2735 0%,
          #090a0f 100%
        );
        overflow: hidden;
      }

      @keyframes move-stars {
        from {
          transform: translateY(0px);
        }
        to {
          transform: translateY(-2000px);
        }
      }

      .stars,
      .stars2,
      .stars3 {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 200%; /* Make background taller to loop */
        display: block;
        background: transparent
          url("data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTkyLjUsNjEuNWMwLDAsMCwwLDBsLTIsMC4xYy0wLjUsMC0xLTAuNS0xLTF2LTJjMC0wLjUsMC41LTEsMS0xaDIsMVY2MS41eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik04My4yLDQyLjRjMCwwLDAsMCwwbDAsMEM4My4yLDQyLjQsODMuMiw0Mi40LDgzLjIsNDIuNHoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNzkuNCwyNC43YzAsMCwwLDAsMGwwLDBDNzkuNCwyNC43LDc5LjQsMjQuNyw3OS40LDI0Ljd6Ii8+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTgwLjYsNDEuNWMwLDAsMCwwLDBsMCwwQzgwLjYsNDEuNSw4MC42LDQxLjUsODAuNiw0MS41eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0yNC4zLDQxYzAsMCwwLDAsMGwtMC4yLTAuMmMwLDAsMCwwLDBMMjQuMyw0MXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNMzEuOCwzOS43YzAsMCwwLDAsMEwzMS44LDM5LjdMMzEuOCwzOS45eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zNy4xLDQwLjljMCwwLDAsMCwwbDAsMEMzNy4xLDQwLjksMzcuMSw0MC45LDM3LjIsNDAuOXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNzMuNCwzMS45YzAsMCwwLDAsMEw3My40LDMxLjlMNzMuNCwzMS45eiIvPjwvc3ZnPg==")
          repeat;
        background-size: 1000px 1000px;
        animation: move-stars 200s linear infinite;
      }
      .stars2 {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTc2LjksMjEuNGMwLDAsMCwwLDBsMCwwQzc2LjksMjEuNCw3Ni45LDIxLjQsNzYuOSwyMS40eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik04NS4yLDU5LjljMCwwLDAsMCwwbDAsMEM4NS4yLDU5LjksODUuMiw1OS45LDg1LjIsNTkuOXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNzAuMywzOS45YzAsMCwwLDAsMEw3MC4zLDM5LjlMNzAuMywzOS45eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik00Ni43LDIwLjlDNDYuNywyMC45LDQ2LjcsMjAuOSw0Ni43LDIwLjlsMCwwQzQ2LjdsMjAuOSw0Ni43LDIwLjksNDYuNywyMC45eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0yMS44LDIxLjljMCwwLDAsMCwwbDAsMEMyMS44LDIxLjksMjEuOCwyMS45LDIxLjgsMjEuOXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNMzEuNyw0OS4xYzAsMCwwLDAsMEwzMS43LDQ5LjFMMzEuNyw0OS4xeiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik0zNy44LDI1LjdjMCwwLDAsMCwwbDAsMEMzNy44LDI1LjcsMzcuOCwyNS43LDM3LjgsMjUuN3oiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNTEuOCwxMy43YzAsMCwwLDAsMEw1MS44LDEzLjdMNTIuMiwxMy45YzAsMCwwLDAsMEw1MS44LDEzLjd6Ii8+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTI3LjEsMTQuNGMwLDAsMCwwLDBsMCwwQzI3LjEsMTQuNCwyNy4xLDE0LjQsMjcuMSwxNC40eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zNy41LDMuNGMwLDAsMCwwLDBsMCwwQzM3LjUsMy40LDM3LjUsMy40LDM3LjUsMy40eiIvPjwvc3ZnPg==");
        animation-duration: 150s;
        animation-delay: -50s;
      }
      .stars3 {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTQ5LjIsMTcuMWMwLDAsMCwwLDBsMCwwQzQ5LjIsMTcuMSw0OS4yLDE3LjEsNDkuMiwxNy4xeiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zMy44LDguNGMwLDAsMCwwLDBsMCwwQzMzLjgsOC44LDMzLjgsOC40LDMzLjgsOC40eiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik04NS4xLDguN2MwLDAsMCwwLDBsMCwwQzg1LjEsOC43LDg1LjEsOC43LDg1LjEsOC43eiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik04Ny44LDE0LjljMCwwLDAsMCwwbDAsMEM4Ny44LDE0LjksODcuOCwxNC45LDg3LjgsMTQuOXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNzkuOSwzOS45YzAsMCwwLDAsMEw3OS45LDM5LjlMNzkuOSwzOS45eiIvPjwvc3ZnPg==");
        animation-duration: 100s;
        animation-delay: -100s;
      }

      /* --- 动画 --- */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .main-container-anim {
        animation: fadeInUp 0.8s 0.2s ease-out backwards;
      }

      .main-container {
        position: relative;
        border-radius: 1rem;
        background-color: rgba(
          13,
          17,
          23,
          0.6
        ); /* Semi-transparent background */
        backdrop-filter: blur(10px);
        z-index: 1;
      }

      .main-container::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 2px; /* Border width */
        background: linear-gradient(135deg, #a97eff, #58a6ff, #00c3ff);
        -webkit-mask: linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        mask-composite: exclude;
        z-index: -1;
      }

      .tech-font {
        font-family: "Exo 2", sans-serif;
      }

      /* --- 输入框和按钮样式 --- */
      .dark-textarea {
        background-color: #0d1117;
        border: 1px solid #30363d;
        color: #c9d1d9;
        transition: all 0.3s ease;
      }
      .dark-textarea:focus {
        border-color: #58a6ff;
        box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
        outline: none;
      }
      .dark-textarea::-webkit-scrollbar {
        width: 12px;
      }
      .dark-textarea::-webkit-scrollbar-track {
        background: #0d1117;
        border-radius: 10px;
      }
      .dark-textarea::-webkit-scrollbar-thumb {
        background-color: #30363d;
        border-radius: 10px;
        border: 3px solid #0d1117;
      }
      .dark-textarea::-webkit-scrollbar-thumb:hover {
        background-color: #58a6ff;
      }
      .dark-textarea::-webkit-resizer {
        background-image: url("data:image/svg+xml;utf8,%3Csvg%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%20fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M8%204L4%208%22%20stroke%3D%22%2358a6ff%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M10%206L6%2010%22%20stroke%3D%22%2358a6ff%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: bottom right;
        border: 2px solid transparent;
      }
      .dark-textarea::-webkit-scrollbar-corner {
        background-color: transparent;
      }

      .btn-sci-fi {
        position: relative;
        padding: 10px 24px;
        border: 2px solid #30363d;
        background-color: transparent;
        color: #c9d1d9;
        font-weight: 700;
        cursor: pointer;
        overflow: hidden;
        transition: all 0.3s ease;
        transform: skew(-15deg);
      }
      .btn-sci-fi > span {
        display: inline-block;
        transform: skew(15deg);
        transition: color 0.3s ease;
      }
      .btn-sci-fi::before {
        content: "";
        position: absolute;
        top: 0;
        left: -150%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          var(--glow-color, rgba(0, 191, 255, 0.5)),
          transparent
        );
        transition: left 0.5s ease;
        transform: skew(-15deg) translateX(50%);
      }

      .btn-sci-fi:hover {
        color: white;
        border-color: var(--glow-color, rgba(0, 191, 255, 0.8));
        box-shadow: 0 0 15px var(--glow-color, rgba(0, 191, 255, 0.5));
      }
      .btn-sci-fi:hover > span {
        color: white;
      }
      .btn-sci-fi:hover::before {
        left: 150%;
      }
      .btn-sci-fi.red {
        --glow-color: #ef4444;
      }

      #notification-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .notification {
        background-color: #161b22cc;
        backdrop-filter: blur(5px);
        color: #f87171; /* red-400 */
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid #ef4444; /* red-500 */
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateX(100%);
        animation: slideIn 0.5s forwards;
      }
      .notification.success {
        color: #4ade80; /* green-400 */
        border-color: #22c55e; /* green-500 */
        box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
      }
      @keyframes slideIn {
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      @keyframes slideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }
    </style>
  </head>
  <body>
    <!-- 动态背景 -->
    <div class="background-container">
      <div class="stars"></div>
      <div class="stars2"></div>
      <div class="stars3"></div>
    </div>
    <!-- 消息通知容器 -->
    <div id="notification-container"></div>

    <div class="w-full max-w-7xl mx-auto p-4 sm:p-8 flex flex-col h-screen">
      <header class="text-center mb-6 header-anim">
        <h1
          class="text-3xl sm:text-4xl font-bold text-cyan-400 tech-font"
          style="text-shadow: 0 0 10px rgba(0, 255, 255, 0.5)"
        >
          Base64 编码/解码
        </h1>
        <p class="text-gray-400 mt-2">一个具有赛博朋克风格的 Base64 工具。</p>
      </header>

      <main
        class="main-container main-container-anim flex-grow flex flex-col p-4 sm:p-6"
      >
        <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-4 min-h-0">
          <!-- 明文输入区域 -->
          <div class="relative flex flex-col h-full min-h-0">
            <div class="flex justify-between items-center mb-2 px-1">
              <h2 class="text-lg text-cyan-400 tech-font">明文</h2>
              <button
                id="copy-plain-btn"
                class="text-gray-400 hover:text-white text-xs tech-font"
              >
                复制
              </button>
            </div>
            <textarea
              id="plain-text"
              rows="12"
              class="dark-textarea w-full h-full p-4 rounded-lg shadow-sm font-mono text-sm"
              placeholder="在此输入要编码的字符串..."
            ></textarea>
            <div
              id="byte-counter"
              class="absolute bottom-3 right-4 text-xs text-gray-500 tech-font pointer-events-none"
            >
              0 字节
            </div>
          </div>

          <!-- Base64 输出区域 -->
          <div class="flex flex-col h-full min-h-0">
            <div class="flex justify-between items-center mb-2 px-1">
              <h2 class="text-lg text-cyan-400 tech-font">Base64</h2>
              <button
                id="copy-base64-btn"
                class="text-gray-400 hover:text-white text-xs tech-font"
              >
                复制
              </button>
            </div>
            <textarea
              id="base64-text"
              rows="12"
              class="dark-textarea w-full h-full p-4 rounded-lg shadow-sm font-mono text-sm"
              placeholder="在此输入要解码的 Base64 字符串..."
            ></textarea>
          </div>
        </div>
        <div class="flex flex-wrap gap-4 mt-6 justify-center">
          <button id="clear-btn" class="btn-sci-fi red">
            <span class="tech-font">清空全部</span>
          </button>
        </div>
      </main>

      <footer class="text-center mt-8 text-gray-500 text-sm">
        <p>Powered by @AhYi8 ✨ &copy; 2024</p>
      </footer>
    </div>

    <script>
      // --- DOM 元素获取 ---
      const plainTextInput = document.getElementById("plain-text");
      const base64TextInput = document.getElementById("base64-text");
      const copyPlainBtn = document.getElementById("copy-plain-btn");
      const copyBase64Btn = document.getElementById("copy-base64-btn");
      const clearBtn = document.getElementById("clear-btn");
      const notificationContainer = document.getElementById(
        "notification-container"
      );
      const byteCounter = document.getElementById("byte-counter");

      // --- 状态变量 ---
      let isProgrammaticUpdate = false;

      // --- 函数定义 ---

      /**
       * 显示消息通知
       * @param {string} message - 要显示的消息
       * @param {string} [type='error'] - 'error' 或 'success'
       */
      function showNotification(message, type = "error") {
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notificationContainer.appendChild(notification);
        notification.addEventListener("click", () => {
          notification.style.animation = "slideOut 0.5s forwards";
          setTimeout(() => notification.remove(), 500);
        });
        setTimeout(() => {
          if (notification.parentElement) {
            notification.style.animation = "slideOut 0.5s forwards";
            setTimeout(() => notification.remove(), 500);
          }
        }, 3000);
      }

      /**
       * 复制指定文本到剪贴板
       * @param {string} textToCopy
       * @param {string} successMessage
       */
      function copyToClipboard(textToCopy, successMessage) {
        if (!textToCopy) {
          showNotification("没有可复制的内容。", "error");
          return;
        }

        const tempTextarea = document.createElement("textarea");
        tempTextarea.value = textToCopy;
        document.body.appendChild(tempTextarea);
        tempTextarea.select();
        tempTextarea.setSelectionRange(0, 99999);

        try {
          document.execCommand("copy");
          showNotification(successMessage, "success");
        } catch (err) {
          showNotification("复制失败。", "error");
          console.error("Copy failed", err);
        }

        document.body.removeChild(tempTextarea);
      }

      /**
       * 清空所有输入框
       */
      function handleClear() {
        isProgrammaticUpdate = true;
        plainTextInput.value = "";
        base64TextInput.value = "";
        updateByteCounter();
        showNotification("已清空。", "success");
        isProgrammaticUpdate = false;
      }

      /**
       * 更新字节计数器
       */
      function updateByteCounter() {
        const text = plainTextInput.value;
        const byteLength = new Blob([text]).size;
        byteCounter.textContent = `${byteLength} 字节`;
      }

      // --- 事件监听 ---
      copyPlainBtn.addEventListener("click", () =>
        copyToClipboard(plainTextInput.value, "已复制明文！")
      );
      copyBase64Btn.addEventListener("click", () =>
        copyToClipboard(base64TextInput.value, "已复制Base64结果！")
      );
      clearBtn.addEventListener("click", handleClear);

      plainTextInput.addEventListener("input", () => {
        if (isProgrammaticUpdate) return;

        updateByteCounter();
        const plainText = plainTextInput.value;

        isProgrammaticUpdate = true;
        if (plainText === "") {
          base64TextInput.value = "";
        } else {
          try {
            const utf8Encoded = new TextEncoder().encode(plainText);
            const base64String = btoa(
              String.fromCharCode.apply(null, utf8Encoded)
            );
            base64TextInput.value = base64String;
          } catch (error) {
            base64TextInput.value = "编码错误...";
          }
        }
        isProgrammaticUpdate = false;
      });

      base64TextInput.addEventListener("input", () => {
        if (isProgrammaticUpdate) return;

        const base64Text = base64TextInput.value;
        isProgrammaticUpdate = true;

        if (base64Text.trim() === "") {
          plainTextInput.value = "";
        } else {
          try {
            if (/[^A-Za-z0-9+/=]/.test(base64Text)) {
              throw new Error("Invalid Base64 character found");
            }
            const decodedString = atob(base64Text);
            const utf8Decoded = new TextDecoder("utf-8", {
              fatal: true,
            }).decode(Uint8Array.from(decodedString, (c) => c.charCodeAt(0)));
            plainTextInput.value = utf8Decoded;
          } catch (error) {
            plainTextInput.value = "解码失败: 无效的Base64字符串...";
          }
        }
        updateByteCounter();
        isProgrammaticUpdate = false;
      });
    </script>
  </body>
</html>
