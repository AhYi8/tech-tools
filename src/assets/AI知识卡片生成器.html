<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI çŸ¥è¯†å¡ç‰‡ç”Ÿæˆå™¨ - é«˜çº§ç§‘æŠ€ç‰ˆ</title>
    <!-- å¼•å…¥ Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ html2canvas for exporting image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* æš—è‰²ç§‘æŠ€é£æ ¼è‡ªå®šä¹‰æ ·å¼ */
      body {
        font-family: 'Noto Sans SC', sans-serif;
        background-color: #0d1117;
        color: #c9d1d9;
        overflow-x: hidden; /* é˜²æ­¢æ¨ªå‘æ»šåŠ¨æ¡ */
      }

      /* -- åŠ¨æ€èƒŒæ™¯ -- */
      .background-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        overflow: hidden;
      }

      @keyframes move-stars {
        from {
          transform: translateY(0px);
        }
        to {
          transform: translateY(-2000px);
        }
      }

      .stars,
      .stars2,
      .stars3 {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        display: block;
        background: transparent;
        background-size: cover;
        animation: move-stars 200s linear infinite;
      }
      .stars {
        background-image: url('data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTkyLjUsNjEuNWMwLDAsMCwwLDBsLTIsMC4xYy0wLjUsMC0xLTAuNS0xLTF2LTJjMC0wLjUsMC41LTEsMS0xaDIsMVY2MS41eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik04My4yLDQyLjRjMCwwLDAsMCwwbDAsMEM4My4yLDQyLjQsODMuMiw0Mi40LDgzLjIsNDIuNHoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNzkuNCwyNC43YzAsMCwwLDAsMGwwLDBDNzkuNCwyNC43LDc5LjQsMjQuNyw3OS40LDI0Ljd6Ii8+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTgwLjYsNDEuNWMwLDAsMCwwLDBsMCwwQzgwLjYsNDEuNSw4MC42LDQxLjUsODAuNiw0MS41eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0yNC4zLDQxYzAsMCwwLDAsMGwtMC4yLTAuMmMwLDAsMCwwLDBMMjQuMyw0MXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNMzEuOCwzOS43YzAsMCwwLDAsMEwzMS44LDM5LjdMMzEuOCwzOS45eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zNy4xLDQwLjljMCwwLDAsMCwwbDAsMEMzNy4xLDQwLjksMzcuMSw0MC45LDM3LjIsNDAuOXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNzMuNCwzMS45YzAsMCwwLDAsMEw3My40LDMxLjlMNzMuNCwzMS45eiIvPjwvc3ZnPg==');
      }
      .stars2 {
        background-image: url('data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTc2LjksMjEuNGMwLDAsMCwwLDBsMCwwQzc2LjksMjEuNCw3Ni45LDIxLjQsNzYuOSwyMS40eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik04NS4yLDU5LjljMCwwLDAsMCwwbDAsMEM4NS4yLDU5LjksODUuMiw1OS45LDg1LjIsNTkuOXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNzAuMywzOS45YzAsMCwwLDAsMEw3MC4zLDM5LjlMNzAuMywzOS45eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik00Ni43LDIwLjlDNDYuNywyMC45LDQ2LjcsMjAuOSw0Ni43LDIwLjlsMCwwQzQ2LjdsMjAuOSw0Ni43LDIwLjksNDYuNywyMC45eiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik0yMS44LDIxLjljMCwwLDAsMCwwbDAsMEMyMS44LDIxLjksMjEuOCwyMS45LDIxLjgsMjEuOXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNMzEuNyw0OS4xYzAsMCwwLDAsMEwzMS43LDQ5LjFMMzEuNyw0OS4xeiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik0zNy44LDI1LjdjMCwwLDAsMCwwbDAsMEMzNy44LDI1LjcsMzcuOCwyNS43LDM3LjgsMjUuN3oiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNTEuOCwxMy43YzAsMCwwLDAsMEw1MS44LDEzLjdMNTIuMiwxMy45YzAsMCwwLDAsMEw1MS44LDEzLjd6Ii8+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTI3LjEsMTQuNGMwLDAsMCwwLDBsMCwwQzI3LjEsMTQuNCwyNy4xLDE0LjQsMjcuMSwxNC40eiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik0zNy41LDMuNGMwLDAsMCwwLDBsMCwwQzM3LjUsMy40LDM3LjUsMy40LDM3LjUsMy40eiIvPjwvc3ZnPg==');
        animation-duration: 150s;
      }
      .stars3 {
        background-image: url('data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTQ5LjIsMTcuMWMwLDAsMCwwLDBsMCwwQzQ5LjIsMTcuMSw0OS4yLDE3LjEsNDkuMiwxNy4xeiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik0zMy44LDguNGMwLDAsMCwwLDBsMCwwQzMzLjgsOC40LDMzLjgsOC40LDMzLjgsOC40eiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik04NS4xLDguN2MwLDAsMCwwLDBsMCwwQzg1LjEsOC43LDg1LjEsOC43LDg1LjEsOC43eiIvPjxwYXRoIGZpbGw=IiNGRkYiIGQ9Ik04Ny44LDE0LjljMCwwLDAsMCwwbDAsMEM4Ny44LDE0LjksODcuOCwxNC45LDg3LjgsMTQuOXoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNNzkuOSwzOS45YzAsMCwwLDAsMEw3OS45LDM5LjlMNzkuOSwzOS45eiIvPjwvc3ZnPg==');
        animation-duration: 100s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header-anim {
        animation: fadeInUp 0.8s ease-out backwards;
      }
      .main-container-anim {
        animation: fadeInUp 0.8s 0.2s ease-out backwards;
      }

      /* -- ä¼˜åŒ–åçš„ main å®¹å™¨æ ·å¼ -- */
      .main-container {
        position: relative;
        border-radius: 1rem;
      }

      .main-container::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 2px; /* è¾¹æ¡†å®½åº¦ */
        background: linear-gradient(135deg, #a97eff, #58a6ff, #00c3ff);
        -webkit-mask:
          linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        mask-composite: exclude;
        z-index: 1; /* æå‡è¾¹æ¡†å±‚çº§ */
        pointer-events: none; /* è®©é¼ æ ‡äº‹ä»¶ç©¿é€è¾¹æ¡† */
      }
      /* -- ç»“æŸä¼˜åŒ– -- */

      h1,
      h2,
      h3,
      .tech-font {
        font-family: 'Exo 2', sans-serif;
      }

      .flashcard {
        background: #1a202cdd;
        backdrop-filter: blur(3px);
        border: 1px solid #30363d;
        border-radius: 12px;
        padding: 24px;
        box-shadow:
          0 0 15px rgba(0, 191, 255, 0.1),
          0 0 5px rgba(0, 191, 255, 0.05);
        word-wrap: break-word;
        page-break-inside: avoid;
        break-inside: avoid;
        transition: all 0.3s ease-in-out;
        animation: fadeInUp 0.5s ease-out backwards;
        position: relative;
        overflow: hidden;
      }

      .flashcard:nth-child(2) {
        animation-delay: 0.1s;
      }
      .flashcard:nth-child(3) {
        animation-delay: 0.2s;
      }
      .flashcard:nth-child(4) {
        animation-delay: 0.3s;
      }
      .flashcard:nth-child(5) {
        animation-delay: 0.4s;
      }
      .flashcard:nth-child(6) {
        animation-delay: 0.5s;
      }

      .flashcard:hover {
        transform: translateY(-8px) scale(1.03);
        box-shadow:
          0 0 30px rgba(0, 191, 255, 0.3),
          0 0 15px rgba(0, 191, 255, 0.15);
        border-color: rgba(0, 191, 255, 0.6);
      }
      .card-title {
        font-family: 'Exo 2', sans-serif;
        font-size: 1.5rem;
        font-weight: 700;
        color: #58a6ff;
        text-shadow: 0 0 5px rgba(88, 166, 255, 0.5);
        margin-bottom: 4px;
      }
      .card-subtitle {
        font-size: 1rem;
        font-weight: 400;
        color: #8b949e;
        margin-bottom: 16px;
        border-bottom: 1px dashed #30363d;
        padding-bottom: 12px;
      }
      .card-description {
        font-size: 1rem;
        color: #c9d1d9;
        margin-bottom: 16px;
      }
      .card-facts {
        list-style-type: none;
        padding-left: 0;
      }
      .card-facts li {
        background-color: rgba(88, 166, 255, 0.1);
        color: #c9d1d9;
        padding: 8px 12px;
        border-left: 3px solid #58a6ff;
        border-radius: 0 4px 4px 0;
        margin-bottom: 8px;
        font-size: 0.9rem;
      }
      #card-container-wrapper {
        background-color: transparent;
      }
      .dark-input {
        background-color: #0d1117;
        border: 1px solid #30363d;
        color: #c9d1d9;
      }
      .dark-input:focus {
        border-color: #58a6ff;
        box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.2);
        outline: none;
      }
      textarea::-webkit-scrollbar {
        width: 12px;
      }
      textarea::-webkit-scrollbar-track {
        background: #0d1117;
        border-radius: 10px;
      }
      textarea::-webkit-scrollbar-thumb {
        background-color: #30363d;
        border-radius: 10px;
        border: 3px solid #0d1117;
      }
      textarea::-webkit-scrollbar-thumb:hover {
        background-color: #58a6ff;
      }

      textarea::-webkit-resizer {
        background-image: url('data:image/svg+xml;utf8,%3Csvg%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%20fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M8%204L4%208%22%20stroke%3D%22%2358a6ff%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3Cpath%20d%3D%22M10%206L6%2010%22%20stroke%3D%22%2358a6ff%22%20stroke-width%3D%221.5%22%20stroke-linecap%3D%22round%22/%3E%3C/svg%3E');
        background-repeat: no-repeat;
        background-position: bottom right;
        border: 2px solid transparent;
      }
      textarea::-webkit-scrollbar-corner {
        background-color: transparent;
      }

      .btn-ai-style {
        position: relative;
        background: #0d1117;
        color: #c9d1d9;
        border: 1px solid #30363d;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
        box-shadow: 0 0 10px rgba(0, 191, 255, 0.2);
      }
      .btn-ai-style:not(:disabled):hover {
        color: white;
        border-color: #58a6ff;
        box-shadow: 0 0 20px rgba(88, 166, 255, 0.5);
      }
      .btn-ai-style:disabled {
        cursor: not-allowed;
        color: #4b5563;
        background-color: #161b22;
      }

      .btn-sci-fi {
        position: relative;
        padding: 12px 30px;
        border: 2px solid #30363d;
        background-color: transparent;
        color: #c9d1d9;
        font-weight: 700;
        cursor: pointer;
        overflow: hidden;
        transition: all 0.3s ease;
        transform: skew(-15deg);
      }
      .btn-sci-fi > span {
        display: inline-block;
        transform: skew(15deg);
        transition: color 0.3s ease;
      }
      .btn-sci-fi::before {
        content: '';
        position: absolute;
        top: 0;
        left: -150%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          var(--glow-color, rgba(0, 191, 255, 0.5)),
          transparent
        );
        transition: left 0.5s ease;
        transform: skew(-15deg) translateX(50%);
      }

      .btn-sci-fi:not(:disabled):hover {
        color: white;
        border-color: var(--glow-color, rgba(0, 191, 255, 0.8));
        box-shadow: 0 0 15px var(--glow-color, rgba(0, 191, 255, 0.5));
      }
      .btn-sci-fi:not(:disabled):hover > span {
        color: white;
      }
      .btn-sci-fi:not(:disabled):hover::before {
        left: 150%;
      }

      .btn-sci-fi.cyan {
        --glow-color: #0891b2;
      }
      .btn-sci-fi.green {
        --glow-color: #16a34a;
      }

      .btn-sci-fi:disabled {
        border-color: #4b5563;
        color: #4b5563;
        cursor: not-allowed;
        box-shadow: none;
      }

      #notification-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .notification {
        background-color: #161b22cc;
        backdrop-filter: blur(5px);
        color: #f87171; /* red-400 */
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid #ef4444; /* red-500 */
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateX(100%);
        animation: slideIn 0.5s forwards;
      }
      .notification.success {
        color: #4ade80; /* green-400 */
        border-color: #22c55e; /* green-500 */
        box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
      }
      @keyframes slideIn {
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      @keyframes slideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }

      /* --- å¼€å…³æŒ‰é’®æ ·å¼ --- */
      .switch {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 22px;
      }
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #30363d;
        transition: 0.4s;
        border-radius: 22px;
      }
      .slider:before {
        position: absolute;
        content: '';
        height: 14px;
        width: 14px;
        left: 4px;
        bottom: 4px;
        background-color: #c9d1d9;
        transition: 0.4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #2563eb;
        box-shadow: 0 0 5px #2563eb;
      }
      input:checked + .slider:before {
        transform: translateX(18px);
      }
      /* --- ç»“æŸå¼€å…³æŒ‰é’®æ ·å¼ --- */

      .export-wrapper {
        padding: 2rem;
        background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        width: 550px;
      }

      .export-wrapper .flashcard {
        background: #1a202c;
        border: 1px solid #30363d;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 0 15px rgba(0, 191, 255, 0.2);
        position: relative;
        overflow: hidden;
        transform: none !important;
        animation: none !important;
      }

      .export-wrapper .flashcard::before {
        content: '';
        position: absolute;
        left: -50%;
        top: -50%;
        width: 200%;
        height: 200%;
        background: conic-gradient(#f474c4, #a97eff, #58a6ff, #00c3ff, #58a6ff, #a97eff, #f474c4);
        animation: rotate-border 4s linear infinite;
      }
      .export-wrapper .flashcard::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        right: 2px;
        bottom: 2px;
        background: #1a202c;
        border-radius: 10px;
      }
      .export-wrapper .flashcard > * {
        position: relative;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <!-- åŠ¨æ€èƒŒæ™¯å®¹å™¨ -->
    <div class="background-container">
      <div class="stars"></div>
      <div class="stars2"></div>
      <div class="stars3"></div>
    </div>
    <!-- æ–°å¢ï¼šæ¶ˆæ¯æé†’å®¹å™¨ -->
    <div id="notification-container"></div>

    <div class="w-full max-w-6xl mx-auto p-4 sm:p-8 relative z-10">
      <header class="text-center mb-8 header-anim">
        <h1
          class="text-3xl sm:text-4xl font-bold text-cyan-400"
          style="text-shadow: 0 0 10px rgba(0, 255, 255, 0.5)"
        >
          AI çŸ¥è¯†çŸ©é˜µç”Ÿæˆå™¨
        </h1>
        <p class="text-gray-400 mt-2">
          è¾“å…¥ä¸€ä¸ªä¸»é¢˜ï¼Œè®© AI ä¸ºæ‚¨æ„å»ºæ·±åº¦çŸ¥è¯†å¡ç‰‡ï¼Œæˆ–æ‰‹åŠ¨ç¼–è¾‘ JSON æ•°æ®ã€‚
        </p>
      </header>

      <main class="main-container main-container-anim">
        <div class="p-6 sm:p-8">
          <!-- AI ç”ŸæˆåŒºåŸŸ -->
          <div class="mb-8 p-4 bg-transparent border-2 border-dashed border-blue-800 rounded-lg">
            <label
              for="ai-topic-input"
              class="block text-lg font-medium text-cyan-400 mb-2 tech-font"
              >1. AI æ™ºèƒ½ç”Ÿæˆ</label
            >
            <p class="text-sm text-gray-400 mb-3">
              è¾“å…¥æ‚¨æƒ³å­¦ä¹ çš„ä¸»é¢˜ï¼ŒAI å°†è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–çŸ¥è¯†å¡ç‰‡ã€‚
            </p>
            <div class="flex flex-col sm:flex-row gap-4">
              <input
                type="text"
                id="ai-topic-input"
                class="dark-input flex-grow p-3 rounded-lg shadow-sm"
                placeholder="ä¾‹å¦‚ï¼šé‡å­è®¡ç®—ã€è®¾è®¡æ¨¡å¼ã€å¤ªé˜³ç³»..."
              />
              <button
                id="ai-generate-btn"
                class="btn-ai-style flex items-center justify-center font-bold py-3 px-6"
              >
                <span id="ai-btn-text" class="tech-font">ğŸš€ AI ç”Ÿæˆ</span>
              </button>
              <button
                id="stop-generate-btn"
                class="btn-ai-style flex items-center justify-center font-bold py-3 px-6"
                disabled
              >
                <span id="stop-btn-text" class="tech-font">ğŸš« åœæ­¢</span>
              </button>
            </div>
            <div id="ai-error-message" class="text-red-400 mt-2 text-sm font-medium"></div>

            <!-- é«˜çº§ API è®¾ç½® -->
            <div class="mt-6 border-t border-gray-700 pt-4">
              <details>
                <summary class="cursor-pointer text-gray-400 hover:text-white tech-font">
                  é«˜çº§ API è®¾ç½®
                </summary>
                <div class="mt-4 space-y-4">
                  <div>
                    <label for="api-type-select" class="block text-sm font-medium text-gray-400"
                      >API ç±»å‹</label
                    >
                    <select
                      id="api-type-select"
                      class="dark-input mt-1 block w-full rounded-md shadow-sm"
                    ></select>
                  </div>
                  <div>
                    <label for="api-url" class="block text-sm font-medium text-gray-400"
                      >API åœ°å€ (URL)</label
                    >
                    <input
                      type="text"
                      id="api-url"
                      class="dark-input mt-1 block w-full rounded-md shadow-sm"
                      readonly
                    />
                  </div>
                  <div>
                    <label for="api-key" class="block text-sm font-medium text-gray-400"
                      >API å¯†é’¥ (Key) - å¯ç”¨è‹±æ–‡é€—å·,åˆ†å‰²å¤šä¸ª</label
                    >
                    <div class="relative mt-1">
                      <input
                        type="password"
                        id="api-key"
                        class="dark-input block w-full rounded-md shadow-sm pr-10"
                        placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„ API Key"
                      />
                      <button
                        type="button"
                        id="toggle-api-key"
                        class="absolute inset-y-0 right-0 pr-3 flex items-center text-blue-400 hover:text-cyan-300 focus:outline-none"
                      >
                        <svg
                          id="eye-open"
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-4 w-4 hidden"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path
                            d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                          <path
                            d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                        </svg>
                        <svg
                          id="eye-closed"
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-4 w-4"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path
                            d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                          <path d="M1 1L23 23" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div>
                    <label for="api-model" class="block text-sm font-medium text-gray-400"
                      >æ¨¡å‹ ID (Model ID)</label
                    >
                    <input
                      type="text"
                      id="api-model"
                      class="dark-input mt-1 block w-full rounded-md shadow-sm"
                      placeholder="ä¾‹å¦‚: gpt-4, gemini-pro"
                    />
                  </div>
                  <div class="flex items-center justify-between">
                    <label for="enable-thinking" class="text-sm font-medium text-gray-400"
                      >å¼€å¯æ€è€ƒè¿‡ç¨‹ (enable_thinking)</label
                    >
                    <label class="switch">
                      <input type="checkbox" id="enable-thinking" />
                      <span class="slider"></span>
                    </label>
                  </div>
                  <button id="save-settings-btn" class="btn-sci-fi cyan w-full sm:w-auto">
                    <span class="tech-font">ä¿å­˜è®¾ç½®</span>
                  </button>
                  <p id="save-feedback" class="text-green-400 text-sm mt-2"></p>
                </div>
              </details>
            </div>
          </div>

          <!-- JSON æ‰‹åŠ¨è¾“å…¥åŒºåŸŸ -->
          <div class="mb-6">
            <label for="json-input" class="block text-lg font-medium text-cyan-400 mb-2 tech-font"
              >2. æ‰‹åŠ¨ç¼–è¾‘ JSON</label
            >
            <p class="text-sm text-gray-400 mb-2">
              åœ¨æ­¤å¤„ç¼–è¾‘æˆ–ç²˜è´´æ‚¨çš„ JSON æ•°æ®ã€‚æ–°æ ¼å¼åŒ…å« title, sub_title, description, å’Œ facts
              æ•°ç»„ã€‚
            </p>
            <textarea
              id="json-input"
              rows="12"
              class="dark-input w-full p-4 rounded-lg shadow-sm font-mono text-sm"
              placeholder="åœ¨æ­¤å¤„ç²˜è´´æˆ–ç¼–è¾‘æ‚¨çš„ JSON..."
            ></textarea>
            <div id="error-message" class="text-red-400 mt-2 text-sm font-medium"></div>
          </div>

          <!-- æ§åˆ¶æŒ‰é’® -->
          <div class="flex flex-col sm:flex-row gap-8 mb-8 items-center justify-center">
            <button id="generate-btn" class="btn-sci-fi cyan">
              <span class="tech-font">ä»æ–‡æœ¬æ¸²æŸ“</span>
            </button>
            <button id="export-btn" class="btn-sci-fi green" disabled>
              <span class="tech-font">å¯¼å‡ºä¸ºå›¾ç‰‡</span>
            </button>
          </div>

          <h2 class="text-2xl font-bold text-cyan-400 mb-4 border-b border-gray-700 pb-2">
            å¡ç‰‡é¢„è§ˆ
          </h2>
          <div id="card-container-wrapper" class="p-4 rounded-lg">
            <div id="card-container" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
              <p id="placeholder-text" class="text-gray-500 col-span-full text-center py-10">
                ...ç³»ç»Ÿå¾…å‘½ä¸­ï¼Œç­‰å¾…ç”ŸæˆæŒ‡ä»¤...
              </p>
            </div>
          </div>
        </div>
      </main>

      <footer class="text-center mt-8 text-gray-500 text-sm">
        <p>Powered by Gemini âœ¨ &copy; 2024</p>
      </footer>
    </div>

    <script>
      // DOM å…ƒç´ 
      const jsonInput = document.getElementById('json-input')
      const generateBtn = document.getElementById('generate-btn')
      const exportBtn = document.getElementById('export-btn')
      const cardContainer = document.getElementById('card-container')
      const errorMessage = document.getElementById('error-message')
      const placeholderText = document.getElementById('placeholder-text')

      const aiTopicInput = document.getElementById('ai-topic-input')
      const aiGenerateBtn = document.getElementById('ai-generate-btn')
      const stopGenerateBtn = document.getElementById('stop-generate-btn')
      const aiErrorMessage = document.getElementById('ai-error-message')
      const aiBtnText = document.getElementById('ai-btn-text')

      // é«˜çº§è®¾ç½®å…ƒç´ 
      const apiTypeSelect = document.getElementById('api-type-select')
      const apiUrlInput = document.getElementById('api-url')
      const apiKeyInput = document.getElementById('api-key')
      const apiModelInput = document.getElementById('api-model')
      const enableThinkingSwitch = document.getElementById('enable-thinking')
      const saveSettingsBtn = document.getElementById('save-settings-btn')
      const saveFeedback = document.getElementById('save-feedback')
      const notificationContainer = document.getElementById('notification-container')
      const toggleApiKeyBtn = document.getElementById('toggle-api-key')
      const eyeOpenIcon = document.getElementById('eye-open')
      const eyeClosedIcon = document.getElementById('eye-closed')

      let abortController = new AbortController()

      // é¢„è®¾ API åœ°å€
      const commonApiEndpoints = [
        {
          name: 'Gemini',
          apiUrl:
            'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent',
        },
        { name: 'OpenAI', apiUrl: 'https://api.openai.com/v1/chat/completions' },
        { name: 'ç¡…åŸºæµåŠ¨', apiUrl: 'https://api.siliconflow.cn/v1/chat/completions' },
        { name: 'Grok', apiUrl: 'https://api.x.ai/v1/chat/completions' },
        { name: 'DeepSeek', apiUrl: 'https://api.deepseek.com/v1/chat/completions' },
        { name: 'OpenRouter', apiUrl: 'https://openrouter.ai/api/v1/chat/completions' },
        { name: '302.AI', apiUrl: 'https://api.302.ai/v1/chat/completions' },
        { name: 'MiniMax', apiUrl: 'https://api.minimax.chat/v1/chat/completions' },
        {
          name: 'é˜¿é‡Œäº‘ç™¾ç‚¼',
          apiUrl: 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions',
        },
        { name: 'GPTGOD', apiUrl: 'https://api.gptgod.online/v1/chat/completions' },
      ]

      // å¡«å…… API ç±»å‹ä¸‹æ‹‰èœå•
      function populateApiEndpoints() {
        commonApiEndpoints.forEach((endpoint) => {
          const option = document.createElement('option')
          option.value = endpoint.apiUrl
          option.textContent = endpoint.name
          apiTypeSelect.appendChild(option)
        })
        const customOption = document.createElement('option')
        customOption.value = 'custom'
        customOption.textContent = 'è‡ªå®šä¹‰'
        apiTypeSelect.appendChild(customOption)
      }

      // å¤„ç† API ç±»å‹å˜åŒ–
      function handleApiTypeChange() {
        const selectedValue = apiTypeSelect.value
        const allSettings = getSettings()

        if (selectedValue === 'custom') {
          apiUrlInput.readOnly = false
          const customConfig = allSettings.providers.custom || {}
          apiUrlInput.value = customConfig.apiUrl || ''
          apiKeyInput.value = customConfig.apiKey || ''
          apiModelInput.value = customConfig.modelId || ''
          enableThinkingSwitch.checked = customConfig.enableThinking || false
          apiUrlInput.placeholder = 'è¯·è¾“å…¥æ‚¨çš„è‡ªå®šä¹‰ API åœ°å€'
        } else {
          apiUrlInput.readOnly = true
          apiUrlInput.value = selectedValue
          const providerConfig = allSettings.providers[selectedValue] || {}
          apiKeyInput.value = providerConfig.apiKey || ''
          apiModelInput.value = providerConfig.modelId || ''
          enableThinkingSwitch.checked = providerConfig.enableThinking || false
        }
      }

      function getSettings() {
        const settings = localStorage.getItem('cardGenApiSettings')
        return settings
          ? JSON.parse(settings)
          : { lastSelected: commonApiEndpoints[0].apiUrl, providers: {} }
      }

      // ä¿å­˜è®¾ç½®
      function saveSettings() {
        const allSettings = getSettings()
        const selectedType = apiTypeSelect.value

        allSettings.lastSelected = selectedType

        const currentConfig = {
          apiKey: apiKeyInput.value,
          modelId: apiModelInput.value,
          enableThinking: enableThinkingSwitch.checked,
        }

        if (selectedType === 'custom') {
          currentConfig.apiUrl = apiUrlInput.value
          allSettings.providers.custom = currentConfig
        } else {
          allSettings.providers[selectedType] = currentConfig
        }

        localStorage.setItem('cardGenApiSettings', JSON.stringify(allSettings))
        showNotification('è®¾ç½®å·²ä¿å­˜ï¼', 'success')
      }

      // åŠ è½½è®¾ç½®
      function loadSettings() {
        const allSettings = getSettings()

        apiTypeSelect.value = allSettings.lastSelected || commonApiEndpoints[0].apiUrl

        handleApiTypeChange()
      }

      // è‡ªå®šä¹‰æ¶ˆæ¯æé†’å‡½æ•°
      function showNotification(message, type = 'error', failedKey = '') {
        const notification = document.createElement('div')
        notification.className = `notification ${type}`
        notification.textContent = message

        if (failedKey) {
          notification.title = 'ç‚¹å‡»å¤åˆ¶'
          notification.onclick = () => {
            const tempInput = document.createElement('input')
            document.body.appendChild(tempInput)
            tempInput.value = failedKey
            tempInput.select()
            document.execCommand('copy')
            document.body.removeChild(tempInput)
            showNotification('å¤±è´¥çš„ Key å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success')
            notification.style.animation = 'slideOut 0.5s forwards'
            setTimeout(() => notification.remove(), 500)
          }
        }

        notificationContainer.appendChild(notification)

        setTimeout(() => {
          notification.style.animation = 'slideOut 0.5s forwards'
          setTimeout(() => notification.remove(), 500)
        }, 5000)
      }

      // åˆ‡æ¢ API Key å¯è§æ€§
      function toggleApiKeyVisibility() {
        const isPassword = apiKeyInput.type === 'password'
        apiKeyInput.type = isPassword ? 'text' : 'password'
        eyeOpenIcon.classList.toggle('hidden', !isPassword)
        eyeClosedIcon.classList.toggle('hidden', isPassword)
      }

      // AI ç”Ÿæˆå‡½æ•°
      async function generateWithAI() {
        const topic = aiTopicInput.value.trim()
        if (!topic) {
          aiErrorMessage.textContent = 'è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„ä¸»é¢˜ã€‚'
          return
        }

        const apiUrl = apiUrlInput.value
        const apiKeys = apiKeyInput.value
          .split(',')
          .map((k) => k.trim())
          .filter(Boolean)
        const model =
          apiModelInput.value || (apiUrl.includes('openai') ? 'gpt-3.5-turbo' : 'gemini-pro')
        const enableThinking = enableThinkingSwitch.checked

        if (!apiUrl || apiKeys.length === 0) {
          aiErrorMessage.textContent = 'è¯·åœ¨é«˜çº§è®¾ç½®ä¸­é…ç½® API åœ°å€å’Œå¯†é’¥ã€‚'
          return
        }

        aiErrorMessage.textContent = ''
        aiGenerateBtn.disabled = true
        stopGenerateBtn.disabled = false
        aiBtnText.textContent = 'ç”Ÿæˆä¸­...'

        abortController = new AbortController()

        const userPrompt = `ä¸ºå…³äºâ€œ${topic}â€çš„ä¸»é¢˜ç”Ÿæˆ6-10ä¸ªè¯¦ç»†çš„çŸ¥è¯†å¡ç‰‡ã€‚è¯·ä½¿ç”¨ä¸­æ–‡å›ç­”ã€‚å“åº”å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ã€å¯ä»¥ç›´æ¥è§£æçš„JSONæ•°ç»„ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½å¿…é¡»åŒ…å«ä»¥ä¸‹é”®ï¼š "title" (å­—ç¬¦ä¸²ï¼Œå¡ç‰‡çš„ä¸»æ ‡é¢˜), "sub_title" (å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªå¯é€‰çš„ã€å¸å¼•äººçš„å‰¯æ ‡é¢˜), "description" (å­—ç¬¦ä¸²ï¼Œå¯¹ä¸»é¢˜çš„ç®€è¦æ¦‚è¿°ï¼Œå¤§çº¦30-50å­—), å’Œ "facts" (å­—ç¬¦ä¸²æ•°ç»„ï¼Œåˆ—å‡º3åˆ°4ä¸ªå…³é”®çŸ¥è¯†ç‚¹æˆ–æ ¸å¿ƒäº‹å®)ã€‚ä¸è¦åœ¨å“åº”ä¸­æ·»åŠ  "json" æˆ– \\\`\\\`\\\` ç­‰æ ‡è®°ã€‚`

        let success = false
        for (const key of apiKeys) {
          if (abortController.signal.aborted) {
            aiErrorMessage.textContent = 'ç”Ÿæˆå·²å–æ¶ˆã€‚'
            break
          }

          try {
            let fetchOptions, requestUrl, responseHandler, body

            if (apiUrl.includes('completions')) {
              // OpenAI and compatible APIs
              requestUrl = apiUrl
              body = {
                model: model,
                messages: [
                  {
                    role: 'system',
                    content:
                      "You are a helpful assistant designed to output a valid JSON array of objects based on the user's request, without any markdown formatting.",
                  },
                  { role: 'user', content: userPrompt },
                ],
              }
              // ä»…å½“å¼€å…³å…³é—­æ—¶ï¼Œæ˜¾å¼æ·»åŠ  enable_thinking: false
              if (!enableThinking) {
                body.enable_thinking = false
              }
              fetchOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${key}` },
                body: JSON.stringify(body),
                signal: abortController.signal,
              }
              responseHandler = async (result) => {
                if (result.choices && result.choices[0]?.message?.content) {
                  return result.choices[0].message.content
                }
                throw new Error('API å“åº”æ ¼å¼ä¸æ­£ç¡®')
              }
            } else {
              // Gemini
              requestUrl = `${apiUrl}?key=${key}`
              fetchOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  contents: [{ role: 'user', parts: [{ text: userPrompt }] }],
                  generationConfig: {
                    responseMimeType: 'application/json',
                    responseSchema: {
                      type: 'ARRAY',
                      items: {
                        type: 'OBJECT',
                        properties: {
                          title: { type: 'STRING' },
                          sub_title: { type: 'STRING' },
                          description: { type: 'STRING' },
                          facts: { type: 'ARRAY', items: { type: 'STRING' } },
                        },
                        required: ['title', 'description', 'facts'],
                      },
                    },
                  },
                }),
                signal: abortController.signal,
              }
              responseHandler = async (result) => {
                if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                  return result.candidates[0].content.parts[0].text
                }
                throw new Error('Gemini å“åº”æ ¼å¼ä¸æ­£ç¡®')
              }
            }

            const response = await fetch(requestUrl, fetchOptions)
            if (!response.ok) {
              const errorBody = await response.json()
              const errorMessage =
                errorBody.error?.message || `è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`
              throw new Error(errorMessage)
            }

            const result = await response.json()
            const jsonText = await responseHandler(result)
            jsonInput.value = JSON.stringify(JSON.parse(jsonText), null, 2)
            generateCards()
            success = true
            break
          } catch (error) {
            if (error.name === 'AbortError') {
              console.log('Fetch aborted by user.')
              aiErrorMessage.textContent = 'ç”Ÿæˆå·²å–æ¶ˆã€‚'
              break
            }
            console.error(`Key ${key} å¤±è´¥:`, error)
            showNotification(
              `Key "${key.slice(0, 4)}...${key.slice(-4)}" å¤±è´¥: ${error.message}`,
              'error',
              key,
            )
          }
        }

        if (!success && !abortController.signal.aborted) {
          aiErrorMessage.textContent = 'æ‰€æœ‰ API Key å‡è¯·æ±‚å¤±è´¥ã€‚'
        }

        aiGenerateBtn.disabled = false
        stopGenerateBtn.disabled = true
        aiBtnText.textContent = 'ğŸš€ AI ç”Ÿæˆ'
      }

      // ä»æ–‡æœ¬æ¡†ç”Ÿæˆå¡ç‰‡å‡½æ•°
      function generateCards() {
        errorMessage.textContent = ''
        cardContainer.innerHTML = ''
        const jsonString = jsonInput.value

        if (!jsonString.trim()) {
          errorMessage.textContent = 'JSON è¾“å…¥æ¡†ä¸èƒ½ä¸ºç©ºã€‚'
          if (placeholderText) placeholderText.style.display = 'block'
          exportBtn.disabled = true
          return
        }

        try {
          const data = JSON.parse(jsonString)
          if (
            !Array.isArray(data) ||
            data.some(
              (item) =>
                typeof item.title === 'undefined' ||
                typeof item.description === 'undefined' ||
                !Array.isArray(item.facts),
            )
          ) {
            throw new Error(
              'JSONæ ¼å¼ä¸æ­£ç¡®ã€‚è¯·ç¡®ä¿å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸”æ¯ä¸ªå¯¹è±¡éƒ½åŒ…å« "title", "description", å’Œ "facts" æ•°ç»„ã€‚',
            )
          }

          if (data.length === 0) {
            if (placeholderText) placeholderText.style.display = 'block'
            exportBtn.disabled = true
          } else {
            if (placeholderText) placeholderText.style.display = 'none'
            data.forEach((item) => {
              const card = document.createElement('div')
              card.className = 'flashcard'

              let cardHTML = `<div><h3 class="card-title">${item.title}</h3>`
              if (item.sub_title) {
                cardHTML += `<h4 class="card-subtitle">${item.sub_title}</h4>`
              }
              cardHTML += `<p class="card-description">${item.description}</p>`

              if (item.facts && item.facts.length > 0) {
                cardHTML += '<ul class="card-facts">'
                item.facts.forEach((fact) => {
                  cardHTML += `<li>${fact}</li>`
                })
                cardHTML += '</ul>'
              }
              cardHTML += '</div>'

              card.innerHTML = cardHTML
              cardContainer.appendChild(card)
            })
            exportBtn.disabled = false
          }
        } catch (e) {
          errorMessage.textContent = `JSONè§£æå¤±è´¥ï¼š${e.message}`
          if (placeholderText) placeholderText.style.display = 'block'
          exportBtn.disabled = true
        }
      }

      // -- å…¨æ–°ä¼˜åŒ–çš„å¯¼å‡ºå›¾ç‰‡å‡½æ•° --
      function exportImage() {
        const originalButtonText = exportBtn.querySelector('span').textContent
        exportBtn.disabled = true
        exportBtn.querySelector('span').textContent = 'å¯¼å‡ºä¸­...'

        const exportWrapper = document.createElement('div')
        exportWrapper.className = 'export-wrapper'

        const cards = cardContainer.querySelectorAll('.flashcard')
        cards.forEach((cardNode) => {
          exportWrapper.appendChild(cardNode.cloneNode(true))
        })

        exportWrapper.style.position = 'absolute'
        exportWrapper.style.left = '-9999px'
        document.body.appendChild(exportWrapper)

        setTimeout(() => {
          html2canvas(exportWrapper, {
            logging: true,
            useCORS: true,
            scale: 2,
            backgroundColor: null,
          })
            .then((canvas) => {
              const link = document.createElement('a')
              link.href = canvas.toDataURL('image/png')
              link.download = 'knowledge-matrix.png'
              document.body.appendChild(link)
              link.click()
              document.body.removeChild(link)
            })
            .catch((err) => {
              console.error('å›¾ç‰‡å¯¼å‡ºå¤±è´¥:', err)
              errorMessage.textContent = 'å›¾ç‰‡å¯¼å‡ºå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯ã€‚'
            })
            .finally(() => {
              document.body.removeChild(exportWrapper)
              exportBtn.disabled = false
              exportBtn.querySelector('span').textContent = originalButtonText
            })
        }, 100)
      }

      // äº‹ä»¶ç›‘å¬
      generateBtn.addEventListener('click', generateCards)
      exportBtn.addEventListener('click', exportImage)
      aiGenerateBtn.addEventListener('click', generateWithAI)
      stopGenerateBtn.addEventListener('click', () => {
        abortController.abort()
      })
      saveSettingsBtn.addEventListener('click', saveSettings)
      apiTypeSelect.addEventListener('change', handleApiTypeChange)
      toggleApiKeyBtn.addEventListener('click', toggleApiKeyVisibility)

      // é¡µé¢åŠ è½½æ—¶åŠ è½½ä¿å­˜çš„è®¾ç½®
      window.addEventListener('load', () => {
        populateApiEndpoints()
        loadSettings()
        // ç¡®ä¿åˆå§‹å›¾æ ‡çŠ¶æ€æ­£ç¡®
        eyeOpenIcon.classList.add('hidden')
        eyeClosedIcon.classList.remove('hidden')
      })
    </script>
  </body>
</html>
